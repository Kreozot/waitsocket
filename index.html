<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>waitsocket</title>
	<meta name="description" content="Documentation for waitsocket">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
	<script async src="assets/js/search.js" id="search-script"></script>
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">waitsocket</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<h1>waitsocket</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#waitsocketjs" id="waitsocketjs" style="color: inherit; text-decoration: none;">
					<h1>WaitSocket.js</h1>
				</a>
				<p><a href="https://www.npmjs.com/package/waitsocket"><img src="https://badgen.net/npm/v/waitsocket" alt="NPM version"></a>
					<a href="https://travis-ci.org/Kreozot/waitsocket"><img src="https://travis-ci.org/Kreozot/waitsocket.svg?branch=main" alt="Build Status"></a>
					<a href="https://codecov.io/gh/Kreozot/waitsocket"><img src="https://codecov.io/gh/Kreozot/waitsocket/branch/main/graph/badge.svg?token=MBOK47MES6" alt="codecov"></a>
					<a href="https://sonarcloud.io/dashboard?id=Kreozot_waitsocket"><img src="https://sonarcloud.io/api/project_badges/measure?project=Kreozot_waitsocket&metric=alert_status" alt="Quality Gate Status"></a>
				<a href="https://bundlephobia.com/result?p=waitsocket"><img src="https://badgen.net/bundlephobia/min/waitsocket" alt="Bundlephobia"></a></p>
				<p>Simplifies communication over WebSocket.</p>
				<a href="#features" id="features" style="color: inherit; text-decoration: none;">
					<h2>Features</h2>
				</a>
				<ul>
					<li><p>Serialization/Deserialization out of the box</p>
					</li>
					<li><p>More structured way to exchange messages (separates <code>type</code> from <code>payload</code>)</p>
						<pre><code class="language-javascript"><span style="color: #001080">waitSocket</span><span style="color: #000000">.</span><span style="color: #795E26">sendMessage</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;MESSAGE_TYPE&#039;</span><span style="color: #000000">, { </span><span style="color: #001080">somePayload:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;example&#039;</span><span style="color: #000000"> });</span>
</code></pre>
					</li>
					<li><p>Convenient way to handle incoming messages:</p>
						<pre><code class="language-javascript"><span style="color: #001080">waitSocket</span><span style="color: #000000">.</span><span style="color: #795E26">onMessage</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;MESSAGE_TYPE&#039;</span><span style="color: #000000">, (</span><span style="color: #001080">payload</span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> </span><span style="color: #795E26">doSomething</span><span style="color: #000000">(</span><span style="color: #001080">payload</span><span style="color: #000000">));</span>
</code></pre>
					</li>
					<li><p>Ability to use a request/response paradigm with WebSockets (mechanism described below):</p>
						<pre><code class="language-javascript"><span style="color: #0000FF">const</span><span style="color: #000000"> { </span><span style="color: #0070C1">payload</span><span style="color: #000000"> } = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">waitSocket</span><span style="color: #000000">.</span><span style="color: #795E26">sendRequest</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;MESSAGE_TYPE&#039;</span><span style="color: #000000">, </span><span style="color: #001080">requestPayload</span><span style="color: #000000">);</span>
</code></pre>
					</li>
					<li><p>JSONSchema validation of each type of incoming and outgoing messages:</p>
						<pre><code class="language-javascript"><span style="color: #001080">waitSocket</span><span style="color: #000000">.</span><span style="color: #001080">validation</span><span style="color: #000000">.</span><span style="color: #001080">incoming</span><span style="color: #000000">.</span><span style="color: #795E26">addJSONSchema</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;MESSAGE_TYPE&#039;</span><span style="color: #000000">, </span><span style="color: #001080">jsonSchemaObject</span><span style="color: #000000">);</span>
</code></pre>
					</li>
					<li><p>Ability to add interceptors to debug or modify incoming and outgoing messages:</p>
						<pre><code class="language-javascript"><span style="color: #001080">waitSocket</span><span style="color: #000000">.</span><span style="color: #001080">interceptors</span><span style="color: #000000">.</span><span style="color: #001080">incoming</span><span style="color: #000000">.</span><span style="color: #795E26">use</span><span style="color: #000000">((</span><span style="color: #001080">messageObject</span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">  </span><span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;Let</span><span style="color: #EE0000">\&#039;</span><span style="color: #A31515">s see what we have received&#039;</span><span style="color: #000000">, </span><span style="color: #001080">messageObject</span><span style="color: #000000">);</span>
<span style="color: #000000">  </span><span style="color: #008000">// And modify the object</span>
<span style="color: #000000">  </span><span style="color: #AF00DB">return</span><span style="color: #000000"> {</span>
<span style="color: #000000">    ...</span><span style="color: #001080">messageObject</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">something:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;new&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">  };</span>
<span style="color: #000000">});</span>
</code></pre>
					</li>
					<li><p>Flexible message format customization</p>
					</li>
					<li><p>Fully TypeScript</p>
					</li>
				</ul>
				<a href="#installation" id="installation" style="color: inherit; text-decoration: none;">
					<h2>Installation</h2>
				</a>
				<pre><code><span style="color: #001080">npm</span><span style="color: #000000"> </span><span style="color: #001080">i</span><span style="color: #000000"> </span><span style="color: #001080">waitsocket</span>
</code></pre>
				<p>or</p>
				<pre><code><span style="color: #001080">yarn</span><span style="color: #000000"> </span><span style="color: #001080">add</span><span style="color: #000000"> </span><span style="color: #001080">waitsocket</span>
</code></pre>
				<a href="#usage" id="usage" style="color: inherit; text-decoration: none;">
					<h2>Usage</h2>
				</a>
				<p><a href="https://kreozot.github.io/waitsocket/">API documentation</a></p>
				<a href="#importing" id="importing" style="color: inherit; text-decoration: none;">
					<h3>Importing</h3>
				</a>
				<pre><code class="language-javascript"><span style="color: #AF00DB">import</span><span style="color: #000000"> </span><span style="color: #001080">WaitSocket</span><span style="color: #000000"> </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;waitsocket&#039;</span><span style="color: #000000">;</span>
</code></pre>
				<a href="#creating-instance" id="creating-instance" style="color: inherit; text-decoration: none;">
					<h3>Creating instance</h3>
				</a>
				<pre><code class="language-javascript"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">waitSocket</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #795E26">WaitSocket</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;ws://my.websocket.server:9000&#039;</span><span style="color: #000000">);</span>
</code></pre>
				<p>Or you can use it with your own instance of WebSocket, or even with some extensions like <a href="https://github.com/appuri/robust-websocket">RobustWebSocket</a>:</p>
				<pre><code class="language-javascript"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">ws</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #795E26">RobustWebSocket</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;ws://my.websocket.server:9000&#039;</span><span style="color: #000000">);</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">waitSocket</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #795E26">WaitSocket</span><span style="color: #000000">(</span><span style="color: #001080">ws</span><span style="color: #000000">);</span>
</code></pre>
				<a href="#jsonschema-validation" id="jsonschema-validation" style="color: inherit; text-decoration: none;">
					<h2>JSONSchema Validation</h2>
				</a>
				<p>You can define JSONSchema for each type of your incoming and outgoing messages. For incoming messages, validation processes original deserialized message (before any interceptors). For outgoing messages, validation processes resulting message (after all interceptors, but before serialization, of course).</p>
				<p>There is two ways of defining JSONSchema for messages: directly as a function argument when you send or receive a message, or link your JSONSchema to certain message type. You can combine these ways, for example, using type linking for outgoing messages (since you can send one message type in many places) and passing JSONSchema as a parameter to message handlers (since you probably handle one message type in one place).</p>
				<p>It may seems excessive, to validate your own outgoing messages on a client side. But since it wouldn&#39;t cost you too much and there are still ways to corrupt your data (with interceptors or even with refactoring), I&#39;m highly recommend you to validate both directions of your communication through WebSocket.</p>
				<a href="#way-1-using-jsonschema-directly-in-message-functions" id="way-1-using-jsonschema-directly-in-message-functions" style="color: inherit; text-decoration: none;">
					<h3>Way 1: Using JSONSchema directly in message functions</h3>
				</a>
				<a href="#sendmessage" id="sendmessage" style="color: inherit; text-decoration: none;">
					<h4>sendMessage</h4>
				</a>
				<pre><code class="language-javascript"><span style="color: #001080">waitSocket</span><span style="color: #000000">.</span><span style="color: #795E26">sendMessage</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;OUTGOING_MESSAGE_TYPE&#039;</span><span style="color: #000000">, </span><span style="color: #001080">payload</span><span style="color: #000000">, </span><span style="color: #001080">outgoingJSONSchemaObject</span><span style="color: #000000">);</span>
</code></pre>
				<a href="#sendrequest" id="sendrequest" style="color: inherit; text-decoration: none;">
					<h4>sendRequest</h4>
				</a>
				<pre><code class="language-javascript"><span style="color: #001080">waitSocket</span><span style="color: #000000">.</span><span style="color: #795E26">sendRequest</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;OUTGOING_MESSAGE_TYPE&#039;</span><span style="color: #000000">, </span><span style="color: #001080">payload</span><span style="color: #000000">, </span><span style="color: #0000FF">null</span><span style="color: #000000">, </span><span style="color: #001080">outgoingJSONSchemaObject</span><span style="color: #000000">, </span><span style="color: #001080">incomingJSONSchemaObject</span><span style="color: #000000">);</span>
</code></pre>
				<a href="#onmessage" id="onmessage" style="color: inherit; text-decoration: none;">
					<h4>onMessage</h4>
				</a>
				<pre><code class="language-javascript"><span style="color: #001080">waitSocket</span><span style="color: #000000">.</span><span style="color: #795E26">onMessage</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;OUTGOING_MESSAGE_TYPE&#039;</span><span style="color: #000000">, (</span><span style="color: #001080">payload</span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {...}, </span><span style="color: #001080">incomingJSONSchemaObject</span><span style="color: #000000">);</span>
</code></pre>
				<a href="#way-2-linking-jsonschema-for-message-type" id="way-2-linking-jsonschema-for-message-type" style="color: inherit; text-decoration: none;">
					<h3>Way 2: Linking JSONSchema for message type</h3>
				</a>
				<pre><code class="language-javascript"><span style="color: #001080">waitSocket</span><span style="color: #000000">.</span><span style="color: #001080">validation</span><span style="color: #000000">.</span><span style="color: #001080">incoming</span><span style="color: #000000">.</span><span style="color: #795E26">addJSONSchema</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;INCOMING_MESSAGE_TYPE&#039;</span><span style="color: #000000">, </span><span style="color: #001080">incomingJSONSchemaObject</span><span style="color: #000000">);</span>
<span style="color: #001080">waitSocket</span><span style="color: #000000">.</span><span style="color: #001080">validation</span><span style="color: #000000">.</span><span style="color: #001080">outgoing</span><span style="color: #000000">.</span><span style="color: #795E26">addJSONSchema</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;OUTGOING_MESSAGE_TYPE&#039;</span><span style="color: #000000">, </span><span style="color: #001080">outgoingJSONSchemaObject</span><span style="color: #000000">);</span>
</code></pre>
				<a href="#customization" id="customization" style="color: inherit; text-decoration: none;">
					<h2>Customization</h2>
				</a>
				<p>If you wish to use your own message format, you can do it by extending WaitSocket class and overriding these functions, responsible for message construction and parsing:</p>
				<ul>
					<li><code>getType(messageObject: MessageType): string</code> - Returns message type.</li>
					<li><code>getPayload(messageObject: MessageType): any</code> - Returns message payload.</li>
					<li><code>getRequestId(messageObject: MessageType): string</code> - Returns message requestId meta data.</li>
					<li><code>getMessageObject(type: string, payload?: any, requestId?: string): MessageType;</code> - Returns message object with type, payload and requestId in it.</li>
				</ul>
				<p>Example (using <code>body</code> parameter instead of <code>payload</code>):</p>
				<pre><code class="language-typescript"><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">myWaitSocket</span><span style="color: #000000"> </span><span style="color: #0000FF">extends</span><span style="color: #000000"> </span><span style="color: #267F99">AbstractWaitSocket</span><span style="color: #000000">&lt;</span><span style="color: #267F99">MyMessageType</span><span style="color: #000000">&gt; {</span>
<span style="color: #000000">  </span><span style="color: #0000FF">protected</span><span style="color: #000000"> </span><span style="color: #795E26">getMessageObject</span><span style="color: #000000">(</span><span style="color: #001080">type</span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">, </span><span style="color: #001080">payload</span><span style="color: #000000">?: </span><span style="color: #267F99">any</span><span style="color: #000000">, </span><span style="color: #001080">requestId</span><span style="color: #000000">?: </span><span style="color: #267F99">string</span><span style="color: #000000">) {</span>
<span style="color: #000000">    </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">result</span><span style="color: #000000">: </span><span style="color: #267F99">DefaultMessageType</span><span style="color: #000000"> = { </span><span style="color: #001080">type</span><span style="color: #000000"> };</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">payload</span><span style="color: #000000">) {</span>
<span style="color: #000000">      </span><span style="color: #001080">result</span><span style="color: #000000">.</span><span style="color: #001080">body</span><span style="color: #000000"> = </span><span style="color: #001080">payload</span><span style="color: #000000">;</span>
<span style="color: #000000">    }</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">requestId</span><span style="color: #000000">) {</span>
<span style="color: #000000">      </span><span style="color: #001080">result</span><span style="color: #000000">.</span><span style="color: #001080">meta</span><span style="color: #000000"> = { </span><span style="color: #001080">requestId</span><span style="color: #000000"> };</span>
<span style="color: #000000">    }</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #001080">result</span><span style="color: #000000">;</span>
<span style="color: #000000">  }</span>


<span style="color: #000000">  </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #795E26">getPayload</span><span style="color: #000000">(</span><span style="color: #001080">messageObject</span><span style="color: #000000">: </span><span style="color: #267F99">PlainObject</span><span style="color: #000000">) {</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #001080">messageObject</span><span style="color: #000000">.</span><span style="color: #001080">body</span><span style="color: #000000">;</span>
<span style="color: #000000">  }</span>
<span style="color: #000000">}</span>
</code></pre>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class=" ">
						<a href="modules.html">Exports</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
					<li class=" tsd-kind-enum">
						<a href="enums/readystate.html" class="tsd-kind-icon">Ready<wbr>State</a>
					</li>
					<li class=" tsd-kind-class tsd-has-type-parameter">
						<a href="classes/abstractwaitsocket.html" class="tsd-kind-icon">Abstract<wbr>Wait<wbr>Socket</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/default.html" class="tsd-kind-icon">default</a>
					</li>
					<li class=" tsd-kind-type-alias">
						<a href="modules.html#defaultmessagetype" class="tsd-kind-icon">Default<wbr>Message<wbr>Type</a>
					</li>
					<li class=" tsd-kind-type-alias tsd-has-type-parameter">
						<a href="modules.html#onmessagecallback" class="tsd-kind-icon">On<wbr>Message<wbr>Callback</a>
					</li>
					<li class=" tsd-kind-variable">
						<a href="modules.html#defaultmessageschema" class="tsd-kind-icon">Default<wbr>Message<wbr>Schema</a>
					</li>
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected method</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
</body>
</html>